<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard - NTT Express</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/stats.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../index.html">
                        NTT Express
                    </a>
                </div>
                <nav class="nav">
                    <ul class="nav-list">
                        <li><a href="staff-dashboard.html" class="nav-link active">Dashboard</a></li>
                        <li><a href="staff-orders.html" class="nav-link">Quản Lý Đơn Hàng</a></li>
                        <li><a href="staff-track.html" class="nav-link">Theo Dõi Giao Hàng</a></li>
                        <li><a href="staff-stats.html" class="nav-link">Thống Kê</a></li>
                    </ul>
                </nav>
                <div class="header-actions">
                    <div class="user-menu">
                        <span class="user-name" id="userName">Staff</span>
                        <button class="btn btn-secondary" onclick="logout()">Đăng Xuất</button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1>Staff Dashboard</h1>
                <p>Quản lý đơn hàng và giao hàng của bạn</p>
            </div>
            <!-- Quick Actions -->
            <div class="quick-actions">
                <h2>Thao Tác Nhanh</h2>
                <div class="actions-grid">
                    <a href="staff-create-order.html" class="action-card">
                        <i data-lucide="plus"></i>
                        <span>Tạo Đơn Hàng Mới</span>
                    </a>
                    <a href="staff-orders.html" class="action-card">
                        <i data-lucide="list"></i>
                        <span>Quản Lý Đơn Hàng</span>
                    </a>
                    <a href="staff-track.html" class="action-card">
                        <i data-lucide="map-pin"></i>
                        <span>Theo Dõi Giao Hàng</span>
                    </a>
                    <a href="staff-stats.html" class="action-card">
                        <i data-lucide="bar-chart-3"></i>
                        <span>Xem Thống Kê</span>
                    </a>
                </div>
            </div>
            <!-- Stats Overview (Staff only) -->
            <div class="stats-overview">
                <h2>Thống Kê Cá Nhân</h2>
                <div class="stats-grid">
                    <div class="stat-card" id="totalOrders">
                        <div class="stat-icon">
                            <i data-lucide="package"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Tổng Đơn Hàng</div>
                        </div>
                        <div class="loading-spinner" style="display: none;">
                            <i data-lucide="loader-2" class="animate-spin"></i>
                        </div>
                    </div>
                    <div class="stat-card" id="pendingOrders">
                        <div class="stat-icon">
                            <i data-lucide="clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Chờ Xử Lý</div>
                        </div>
                        <div class="loading-spinner" style="display: none;">
                            <i data-lucide="loader-2" class="animate-spin"></i>
                        </div>
                    </div>
                    <div class="stat-card" id="shippingOrders">
                        <div class="stat-icon">
                            <i data-lucide="truck"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Đang Giao</div>
                        </div>
                        <div class="loading-spinner" style="display: none;">
                            <i data-lucide="loader-2" class="animate-spin"></i>
                        </div>
                    </div>
                    <div class="stat-card" id="deliveredOrders">
                        <div class="stat-icon">
                            <i data-lucide="check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Đã Giao</div>
                        </div>
                        <div class="loading-spinner" style="display: none;">
                            <i data-lucide="loader-2" class="animate-spin"></i>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Recent Orders -->
            <div class="recent-orders">
                <div class="section-header">
                    <h2>Đơn Hàng Gần Đây</h2>
                    <a href="staff-orders.html" class="btn btn-secondary">Xem Tất Cả</a>
                </div>
                <div class="table-container">
                    <table class="table" id="recentOrdersTable">
                        <thead>
                            <tr>
                                <th>Mã Đơn</th>
                                <th>Người Gửi</th>
                                <th>Người Nhận</th>
                                <th>Trạng Thái</th>
                                <th>Ngày Tạo</th>
                                <th>Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody id="recentOrdersBody">
                            <tr>
                                <td colspan="6" class="text-center">Đang tải...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
    <script src="../js/lucide.min.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        lucide.createIcons();
        auth.redirectIfNotStaff();
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        document.getElementById('userName').textContent = user.full_name || 'Staff';
        // Stats loading
        function showStatsLoading(show) {
            const statIds = ['totalOrders', 'pendingOrders', 'shippingOrders', 'deliveredOrders'];
            statIds.forEach((statId) => {
                const statCard = document.getElementById(statId);
                if (statCard) {
                    const statValue = statCard.querySelector('.stat-value');
                    const spinner = statCard.querySelector('.loading-spinner');
                    if (statValue && spinner) {
                        if (show) {
                            spinner.style.display = 'inline';
                            statValue.style.display = 'none';
                        } else {
                            spinner.style.display = 'none';
                            statValue.style.display = 'inline';
                        }
                    }
                }
            });
        }
        function updateStatValue(elementId, value) {
            const element = document.getElementById(elementId);
            if (!element) return;
            const statValue = element.querySelector('.stat-value');
            const spinner = element.querySelector('.loading-spinner');
            if (statValue && spinner) {
                statValue.textContent = value;
                statValue.style.display = 'inline';
                spinner.style.display = 'none';
            }
        }
        // Load dashboard data
        async function loadDashboardData() {
            try {
                showStatsLoading(true);
                // Lấy thống kê cá nhân (staff)
                const statsResponse = await api.getStaffStats();
                if (statsResponse.success && statsResponse.data) {
                    const totals = statsResponse.data;
                    updateStatValue('totalOrders', parseInt(totals.total_orders) || 0);
                    updateStatValue('pendingOrders', parseInt(totals.pending_orders) || 0);
                    updateStatValue('shippingOrders', parseInt(totals.shipping_orders) || 0);
                    updateStatValue('deliveredOrders', parseInt(totals.delivered_orders) || 0);
                } else {
                    updateStatValue('totalOrders', 0);
                    updateStatValue('pendingOrders', 0);
                    updateStatValue('shippingOrders', 0);
                    updateStatValue('deliveredOrders', 0);
                }
                // Đơn hàng gần đây
                const ordersResponse = await api.getOrders({ limit: 5 });
                if (ordersResponse.success) {
                    displayRecentOrders(ordersResponse.data.orders);
                }
            } catch (error) {
                updateStatValue('totalOrders', 0);
                updateStatValue('pendingOrders', 0);
                updateStatValue('shippingOrders', 0);
                updateStatValue('deliveredOrders', 0);
            } finally {
                showStatsLoading(false);
            }
        }
        function displayRecentOrders(orders) {
            const tbody = document.getElementById('recentOrdersBody');
            if (!orders || orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">Không có đơn hàng nào</td></tr>';
                return;
            }
            tbody.innerHTML = orders.map(order => `
                <tr>
                    <td><strong>${order.order_code}</strong></td>
                    <td>${order.sender_name}</td>
                    <td>${order.receiver_name}</td>
                    <td>${order.current_status}</td>
                    <td>${order.created_at ? new Date(order.created_at).toLocaleString('vi-VN') : '-'}</td>
                    <td>
                        <a href="staff-order-detail.html?id=${order.id}" class="btn btn-sm btn-primary">Xem</a>
                        <a href="staff-order-edit.html?id=${order.id}" class="btn btn-sm btn-secondary">Sửa</a>
                    </td>
                </tr>
            `).join('');
        }
        function logout() { api.logout(); }
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
        });
    </script>
</body>
</html> 